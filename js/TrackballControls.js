THREE.TrackballControls=function(e,t){var n=this;var o={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.noRoll=false;this.staticMoving=false;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var a=1e-6;var s=new THREE.Vector3;var i=o.NONE,c=o.NONE,r=new THREE.Vector3,p=new THREE.Vector3,h=new THREE.Vector3,l=new THREE.Vector2,u=new THREE.Vector2,d=0,f=0,g=new THREE.Vector2,E=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var m={type:"change"};var v={type:"start"};var y={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var e=this.domElement.getBoundingClientRect();var t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft;this.screen.top=e.top+window.pageYOffset-t.clientTop;this.screen.width=e.width;this.screen.height=e.height}};this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};this.getMouseOnScreen=function(e,t,o){return o.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height)};this.getMouseProjectionOnBall=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(o,a,s){t.set((o-n.screen.width*.5-n.screen.left)/(n.screen.width*.5),(n.screen.height*.5+n.screen.top-a)/(n.screen.height*.5),0);var i=t.length();if(n.noRoll){if(i<Math.SQRT1_2){t.z=Math.sqrt(1-i*i)}else{t.z=.5/i}}else if(i>1){t.normalize()}else{t.z=Math.sqrt(1-i*i)}r.copy(n.object.position).sub(n.target);s.copy(n.object.up).setLength(t.y);s.add(e.copy(n.object.up).cross(r).setLength(t.x));s.add(r.setLength(t.z));return s}}();this.rotateCamera=function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(){var o=Math.acos(p.dot(h)/p.length()/h.length());if(o){e.crossVectors(p,h).normalize();o*=n.rotateSpeed;t.setFromAxisAngle(e,-o);r.applyQuaternion(t);n.object.up.applyQuaternion(t);h.applyQuaternion(t);if(n.staticMoving){p.copy(h)}else{t.setFromAxisAngle(e,o*(n.dynamicDampingFactor-1));p.applyQuaternion(t)}}}}();this.zoomCamera=function(){if(i===o.TOUCH_ZOOM){var e=d/f;d=f;r.multiplyScalar(e)}else{var e=1+(u.y-l.y)*n.zoomSpeed;if(e!==1&&e>0){r.multiplyScalar(e);if(n.staticMoving){l.copy(u)}else{l.y+=(u.y-l.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,o=new THREE.Vector3;return function(){e.copy(E).sub(g);if(e.lengthSq()){e.multiplyScalar(r.length()*n.panSpeed);o.copy(r).cross(n.object.up).setLength(e.x);o.add(t.copy(n.object.up).setLength(e.y));n.object.position.add(o);n.target.add(o);if(n.staticMoving){g.copy(E)}else{g.add(e.subVectors(E,g).multiplyScalar(n.dynamicDampingFactor))}}}}();this.checkDistances=function(){if(!n.noZoom||!n.noPan){if(r.lengthSq()>n.maxDistance*n.maxDistance){n.object.position.addVectors(n.target,r.setLength(n.maxDistance))}if(r.lengthSq()<n.minDistance*n.minDistance){n.object.position.addVectors(n.target,r.setLength(n.minDistance))}}};this.update=function(){r.subVectors(n.object.position,n.target);if(!n.noRotate){n.rotateCamera()}if(!n.noZoom){n.zoomCamera()}if(!n.noPan){n.panCamera()}n.object.position.addVectors(n.target,r);n.checkDistances();n.object.lookAt(n.target);if(s.distanceToSquared(n.object.position)>a){n.dispatchEvent(m);s.copy(n.object.position)}};this.reset=function(){i=o.NONE;c=o.NONE;n.target.copy(n.target0);n.object.position.copy(n.position0);n.object.up.copy(n.up0);r.subVectors(n.object.position,n.target);n.object.lookAt(n.target);n.dispatchEvent(m);s.copy(n.object.position)};function O(e){if(n.enabled===false)return;window.removeEventListener("keydown",O);c=i;if(i!==o.NONE){return}else if(e.keyCode===n.keys[o.ROTATE]&&!n.noRotate){i=o.ROTATE}else if(e.keyCode===n.keys[o.ZOOM]&&!n.noZoom){i=o.ZOOM}else if(e.keyCode===n.keys[o.PAN]&&!n.noPan){i=o.PAN}}function b(e){if(n.enabled===false)return;i=c;window.addEventListener("keydown",O,false)}function w(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();if(i===o.NONE){i=e.button}if(i===o.ROTATE&&!n.noRotate){n.getMouseProjectionOnBall(e.pageX,e.pageY,p);h.copy(p)}else if(i===o.ZOOM&&!n.noZoom){n.getMouseOnScreen(e.pageX,e.pageY,l);u.copy(l)}else if(i===o.PAN&&!n.noPan){n.getMouseOnScreen(e.pageX,e.pageY,g);E.copy(g)}document.addEventListener("mousemove",T,false);document.addEventListener("mouseup",R,false);n.dispatchEvent(v)}function T(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();if(i===o.ROTATE&&!n.noRotate){n.getMouseProjectionOnBall(e.pageX,e.pageY,h)}else if(i===o.ZOOM&&!n.noZoom){n.getMouseOnScreen(e.pageX,e.pageY,u)}else if(i===o.PAN&&!n.noPan){n.getMouseOnScreen(e.pageX,e.pageY,E)}}function R(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();i=o.NONE;document.removeEventListener("mousemove",T);document.removeEventListener("mouseup",R);n.dispatchEvent(y)}function M(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta){t=e.wheelDelta/40}else if(e.detail){t=-e.detail/3}l.y+=t*.01;n.dispatchEvent(v);n.dispatchEvent(y)}function j(e){if(n.enabled===false)return;switch(e.touches.length){case 1:i=o.TOUCH_ROTATE;h.copy(n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,p));break;case 2:i=o.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX;var a=e.touches[0].pageY-e.touches[1].pageY;f=d=Math.sqrt(t*t+a*a);break;case 3:i=o.TOUCH_PAN;E.copy(n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,g));break;default:i=o.NONE}n.dispatchEvent(v)}function N(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();switch(e.touches.length){case 1:n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,h);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX;var a=e.touches[0].pageY-e.touches[1].pageY;f=Math.sqrt(t*t+a*a);break;case 3:n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,E);break;default:i=o.NONE}}function H(e){if(n.enabled===false)return;switch(e.touches.length){case 1:p.copy(n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,h));break;case 2:d=f=0;break;case 3:g.copy(n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,E));break}i=o.NONE;n.dispatchEvent(y)}this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",w,false);this.domElement.addEventListener("mousewheel",M,false);this.domElement.addEventListener("DOMMouseScroll",M,false);this.domElement.addEventListener("touchstart",j,false);this.domElement.addEventListener("touchend",H,false);this.domElement.addEventListener("touchmove",N,false);window.addEventListener("keydown",O,false);window.addEventListener("keyup",b,false);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);